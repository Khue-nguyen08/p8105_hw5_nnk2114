---
title: "p8105_hw5_nnk2114"
output: github_document
---

```{r, include = FALSE, message = FALSE, warning = FALSE}
library(tidyverse)
library(rvest)
library(readxl)
set.seed(1)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1
```{r}
bday_sim = function(n_room) {
  birthdays = sample (1:365, n_room, replace = TRUE)
  repeated_bday = length(unique(birthdays)) <n_room
repeated_bday
}

```

View the results

```{r}
bday_sim_results =
  expand_grid(
    bdays = 5: 50,
    iter = 1:10000
  )|>
  mutate(
    results = map_lgl(bdays, bday_sim)
  ) |>
  group_by(
    bdays
  ) |>
  summarize(
    prob_repeat= mean(results)
  )

```

Plot this
```{r}
bday_sim_results |>
  ggplot(aes( x= bdays, y = prob_repeat)) +
   geom_line(color = "blue") +
   geom_hline(yintercept = 0.5, linetype = "dashed", color = "red") +
  labs(title = "Probability of Shared Birthday vs Group Size",
       x = "Group Size",
       y = "Probability of Shared Birthday") +
  theme_minimal()
```


## Problem 2

Define the function
```{r}
sim_t_test = function(samp_size = 30, mu = 0, sigma = 5, alpha = 0.05){
  
  results = 
    map(1:100, ~ rnorm(n = samp_size, mean = mu, sd = sigma)) |> 
    map(~ t.test(.x, mu = 0)) |> 
    map_df(~ broom::tidy(.x)) |> 
    select(estimate, p.value) |> 
    mutate(reject_null = p.value < alpha)
  
  return(results)
}

```

Run for mu = (1,2,3,4,5,6)

```{r}
t_test_results =
  expand_grid(mu = 0:6) |> 
  mutate(result = map(mu, ~ sim_t_test(mu = .x))) |> 
  unnest(cols = c(result))
```

Make the power plot

```{r}
power_plot = 
t_test_results |> 
  group_by(mu) |> 
  summarize(
    proportion = mean(reject_null)
  )
```

```{r}
power_plot |> 
  ggplot(aes(x = mu, y = proportion)) +
  geom_point(color = "red") +
  geom_line(color = "darkred") +
   labs(
    title = "Power Curve of One-Sample t-test",
    x = expression("True mean ("*mu*")"),
    y = "Power"
  ) +
  theme_minimal(base_size = 14)
```


When μ increases, the power of the test also increases which shows that the probability of rejecting the null hypothesis increases for larger effect sizes. The test is sensitive to the differences between the 0 and the true μ, thus the test tend to rejects null hypothesis more when the true μ increases far from 0. When μ is closer to 0, the test rarely rejects the null hypothesis. 
 
Compute the average

```{r}
avg_estimates =
  t_test_results |>
  group_by(mu) |>
  summarize(
    mean_est_all = mean(estimate),
    mean_est_reject = mean(estimate[reject_null]),
    .groups = "drop"
  )
```

```{r}
avg_estimates |>
  ggplot(aes(x = mu)) +
  geom_line(aes(y = mean_est_all, color = "All samples")) +
  geom_point(aes(y = mean_est_all, color = "All samples")) +
  geom_line(aes(y = mean_est_reject, color = "Null rejected"), linetype = "dashed") +
  geom_point(aes(y = mean_est_reject, color = "Null rejected")) +
  scale_color_manual(values = c("All samples" = "darkblue", "Null rejected" = "red")) +
  geom_abline(intercept = 0, slope = 1, linetype = "dotted") +
  scale_x_continuous(breaks = 0:6) +
  labs(
    title = "Average Estimate of μ hat by True Mean (μ)",
    x = expression("True mean ("*mu*")"),
    y = expression("Average estimate ("*hat(mu)*")"),
    color = " "
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "bottom")
```










